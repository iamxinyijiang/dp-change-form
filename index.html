<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Change Form Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      max-width: 700px;
    }
    input, select, button {
      margin: 0.5rem 0;
      padding: 0.4rem;
      width: 100%;
    }
    textarea {
      width: 100%;
      height: 200px;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <h1>PO Change Request Generator</h1>
  <label>PO Number:
    <input type="text" id="poNumber" placeholder="e.g. 8503897644">
  </label>
  <label>Location:
    <input type="text" id="location" placeholder="e.g. Prestons">
  </label>
  <label>Target Total DP:
    <select id="targetDP">
      <option value="120">120</option>
      <option value="132">132</option>
      <option value="240">240</option>
    </select>
  </label>

  <h3>Enter Current Quantities</h3>
  <label>4061 4635 16428 (5 units/dp):
    <input type="number" id="qty1" placeholder="e.g. 530">
  </label>
  <label>4061 4635 15865 (2 units/dp):
    <input type="number" id="qty2" placeholder="e.g. 144">
  </label>
  <label>4061 4617 55737 (5 units/dp):
    <input type="number" id="qty3" placeholder="e.g. 310">
  </label>

  <button onclick="generateEmail()">Generate Email</button>

  <textarea id="output" readonly placeholder="Generated email will appear here..."></textarea>

  <script>
    function generateEmail() {
      const po = document.getElementById('poNumber').value;
      const location = document.getElementById('location').value;
      const targetDP = parseInt(document.getElementById('targetDP').value);

      const qty1 = parseInt(document.getElementById('qty1').value) || 0;
      const qty2 = parseInt(document.getElementById('qty2').value) || 0;
      const qty3 = parseInt(document.getElementById('qty3').value) || 0;

      const dp1 = Math.round(qty1 / 5);
      const dp2 = Math.round(qty2 / 2);
      const dp3 = Math.round(qty3 / 5);
      const totalCurrentDP = dp1 + dp2 + dp3;

      const diffDP = totalCurrentDP - targetDP;
      let output = `Hi Team,\n\nPlease find attached PO ${po} for ${location}. The order currently has ${totalCurrentDP} DP.\nPlease kindly change it as the following, so the total is ${targetDP} DP.\n\nGTIN                                               Quantity`;

      let updated = [];
      let remainingDP = targetDP;

      if (dp1 > 0) {
        const newDP1 = Math.min(dp1, remainingDP);
        updated.push(`4061 4635 16428                      Decrease From ${qty1} to ${newDP1 * 5}             =    ${newDP1} dp`);
        remainingDP -= newDP1;
      }
      if (dp2 > 0 && remainingDP > 0) {
        const newDP2 = Math.min(dp2, remainingDP);
        updated.push(`4061 4635 15865                      Decrease From ${qty2} to ${newDP2 * 2}             =    ${newDP2} dp`);
        remainingDP -= newDP2;
      }
      if (dp3 > 0 && remainingDP > 0) {
        const newDP3 = Math.min(dp3, remainingDP);
        updated.push(`4061 4617 55737                      Decrease From ${qty3} to ${newDP3 * 5}             =    ${newDP3} dp`);
        remainingDP -= newDP3;
      }

      output += `\n` + updated.join(`\n`) + `\n\n                                                                                                             ___________\n                                                                                 T o t a l                              ${targetDP} dp\n                                                                                                            ========`;

      document.getElementById('output').value = output;
    }
  </script>
</body>
</html>
